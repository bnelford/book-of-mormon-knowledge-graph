<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book of Mormon Knowledge Graph</title>
  <script type="text/javascript" src="https://unpkg.com/vis-network@9.1.9/dist/vis-network.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style type="text/css">
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow: hidden;
    }

    .main-container {
      display: flex;
      height: 100vh;
      position: relative;
    }

    .graph-container {
      flex: 1;
      position: relative;
      margin: 20px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      background: white;
    }

    #mynetwork {
      width: 100%;
      height: 100%;
      border-radius: 16px;
    }

    .sidebar {
      width: 350px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-left: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      flex-direction: column;
      box-shadow: -10px 0 30px rgba(0, 0, 0, 0.1);
    }

    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .sidebar-header h1 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .sidebar-header p {
      font-size: 14px;
      opacity: 0.9;
      font-weight: 300;
    }

    .search-section {
      padding: 24px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .filter-section {
      padding: 24px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .filter-section h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #2d3748;
    }

    .filter-legend {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .filter-legend .legend-item {
      display: flex;
      align-items: center;
      font-size: 12px;
      color: #4a5568;
    }

    .filter-legend .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .search-section h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #2d3748;
    }

    #searchInput {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s ease;
      background: white;
    }

    #searchInput:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    #searchResults {
      max-height: 200px;
      overflow-y: auto;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      margin-top: 12px;
      background: white;
    }

    #searchResults div {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid #f7fafc;
      transition: all 0.2s ease;
      font-size: 14px;
    }

    #searchResults div:last-child {
      border-bottom: none;
    }

    #searchResults div:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateX(4px);
    }

    .details-section {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    .details-section h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #2d3748;
    }

    #detailsContent {
      font-size: 14px;
      line-height: 1.6;
      color: #4a5568;
      background: #f7fafc;
      padding: 16px;
      border-radius: 12px;
      border-left: 4px solid #667eea;
      transition: all 0.3s ease;
      min-height: 120px;
    }

    .selected-node {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%) !important;
      border-left: 4px solid #667eea !important;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15) !important;
    }

    .selected-node h4 {
      color: #667eea !important;
    }

    .legend {
      position: absolute;
      bottom: 24px;
      left: 24px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .legend h4 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #2d3748;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
      color: #4a5568;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      margin-right: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .title-overlay {
      position: absolute;
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 16px 32px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .title-overlay h1 {
      font-size: 24px;
      font-weight: 700;
      color: #2d3748;
      text-align: center;
      margin: 0;
    }

    .title-overlay p {
      font-size: 14px;
      color: #718096;
      text-align: center;
      margin: 4px 0 0 0;
      font-weight: 400;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        height: 40vh;
        order: 2;
      }
      
      .graph-container {
        height: 60vh;
        margin: 10px;
      }
      
      .legend {
        bottom: 10px;
        left: 10px;
        right: 10px;
        padding: 12px;
      }
      
      .title-overlay {
        top: 10px;
        left: 10px;
        right: 10px;
        transform: none;
        padding: 12px 20px;
      }
      
      .title-overlay h1 {
        font-size: 18px;
      }
    }

    /* Animation for smooth transitions */
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Loading state */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      font-size: 16px;
      color: #718096;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid #e2e8f0;
      border-top: 2px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 12px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
<div class="main-container">
  <div class="graph-container">
    <div id="mynetwork"></div>
    
    <div class="title-overlay">
      <h1>Book of Mormon Knowledge Graph</h1>
      <p>Explore the interconnected world of people, places, and events</p>
    </div>
    
    <div class="legend">
      <h4>Node Types</h4>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #FF5733;"></div>
        <span>Person</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #33FF57;"></div>
        <span>Group</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #3357FF;"></div>
        <span>Place</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #FFC300;"></div>
        <span>Event</span>
      </div>
    </div>
  </div>

  <div class="sidebar">
    <div class="sidebar-header">
      <h1>Knowledge Graph</h1>
      <p>Interactive exploration of Book of Mormon entities</p>
    </div>
    
    <div class="search-section">
      <h3>Search</h3>
      <input type="text" id="searchInput" placeholder="Search for people, places, events...">
      <div id="searchResults"></div>
    </div>
    
    <div class="filter-section">
      <h3>Filter Relationships</h3>
      <select id="edgeFilter" style="width: 100%; padding: 8px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white; margin-bottom: 12px;">
        <option value="all">All Relationships</option>
        <option value="sibling_of">Sibling Of</option>
        <option value="parent_of">Parent Of</option>
        <option value="member_of">Member Of</option>
        <option value="involved_in">Involved In</option>
        <option value="occurred_at">Occurred At</option>
        <option value="founded">Founded</option>
        <option value="converted">Converted</option>
        <option value="ancestor_of">Ancestor Of</option>
        <option value="opposed_by">Opposed By</option>
        <option value="prophesied_by">Prophesied By</option>
        <option value="taught_by">Taught By</option>
        <option value="allied_with">Allied With</option>
      </select>
      <div class="filter-legend">
        <div class="legend-item">
          <div class="legend-color" style="background-color: #e53e3e;"></div>
          <span>Opposed By</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #3182ce;"></div>
          <span>Prophesied By</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #38a169;"></div>
          <span>Taught By</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #805ad5;"></div>
          <span>Allied With</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #a0aec0;"></div>
          <span>Other</span>
        </div>
      </div>
    </div>
    
    <div class="details-section">
      <h3>Details</h3>
      <div id="detailsContent"><div style="text-align: center; color: #a0aec0; font-style: italic;">Click on a node to see detailed information, or hover over nodes and edges to preview details.</div></div>
    </div>
  </div>
</div>

<script type="text/javascript">
  // Load JSON data from external file
  fetch('knowledge-graph.json')
    .then(response => {
      if (!response.ok) {
        throw new Error('Failed to load knowledge-graph.json: ' + response.statusText);
      }
      return response.json();
    })
    .then(graphData => {
      // Validate JSON structure
      if (!graphData.nodes || !graphData.edges) {
        throw new Error('Invalid JSON structure: nodes or edges missing');
      }
      // Enhance nodes with additional details
      graphData.nodes = graphData.nodes.map(node => ({
        ...node,
        title: `ID: ${node.id}\nType: ${node.type}\nLabel: ${node.label}`
      }));

      // Add color coding for nodes based on their type
      var colorByType = {
        person: '#FF5733',
        group: '#33FF57',
        place: '#3357FF',
        event: '#FFC300'
      };

      // Add color coding for edges based on their relationship type
      var colorByRelationship = {
        'opposed_by': '#e53e3e',
        'prophesied_by': '#3182ce',
        'taught_by': '#38a169',
        'allied_with': '#805ad5',
        'sibling_of': '#ed8936',
        'parent_of': '#d69e2e',
        'member_of': '#38b2ac',
        'involved_in': '#4299e1',
        'occurred_at': '#9f7aea',
        'founded': '#f56565',
        'converted': '#48bb78',
        'ancestor_of': '#ed64a6'
      };

      graphData.nodes = graphData.nodes.map(node => ({
        ...node,
        color: colorByType[node.type] || '#CCCCCC' // Default color for unknown types
      }));

      // Add color coding to edges
      graphData.edges = graphData.edges.map(edge => ({
        ...edge,
        color: {
          color: colorByRelationship[edge.label] || '#a0aec0',
          highlight: colorByRelationship[edge.label] || '#667eea',
          hover: colorByRelationship[edge.label] || '#667eea'
        }
      }));

      // Initialize vis.js network
      var container = document.getElementById('mynetwork');
      if (!container) {
        throw new Error('Container element #mynetwork not found');
      }
      var data = {
        nodes: new vis.DataSet(graphData.nodes),
        edges: new vis.DataSet(graphData.edges)
      };
      var options = {
        nodes: {
          shape: 'dot',
          size: 20,
          font: { 
            size: 14,
            color: '#2d3748',
            strokeWidth: 2,
            strokeColor: '#ffffff'
          },
          title: function(node) {
            return node.references ? node.references.join(', ') : 'No references available';
          },
          borderWidth: 3,
          borderColor: '#ffffff',
          shadow: {
            enabled: true,
            color: 'rgba(0, 0, 0, 0.2)',
            size: 8,
            x: 2,
            y: 2
          }
        },
        edges: {
          arrows: 'to',
          font: { 
            size: 12,
            color: '#4a5568',
            strokeWidth: 2,
            strokeColor: '#ffffff'
          },
          color: { 
            color: '#a0aec0',
            highlight: '#667eea',
            hover: '#667eea'
          },
          smooth: {
            type: 'continuous',
            forceDirection: 'none',
            roundness: 0.4
          },
          width: 2,
          shadow: {
            enabled: true,
            color: 'rgba(0, 0, 0, 0.1)',
            size: 4,
            x: 1,
            y: 1
          }
        },
        physics: {
          forceAtlas2Based: {
            springLength: 120,
            springConstant: 0.04,
            damping: 0.09,
            avoidOverlap: 0.5
          },
          minVelocity: 0.75,
          solver: 'forceAtlas2Based',
          stabilization: {
            enabled: true,
            iterations: 100,
            updateInterval: 25
          }
        },
        interaction: {
          tooltipDelay: 300,
          hover: true,
          hoverConnectedEdges: true,
          selectConnectedEdges: false
        },
        layout: {
          improvedLayout: true
        }
      };
      var network = new vis.Network(container, data, options);

      // Remove modal logic
      var detailsPane = document.getElementById("detailsPane");
      var detailsContent = document.getElementById("detailsContent");

      // Function to create clickable reference links
      function createReferenceLinks(references) {
        if (!references || references.length === 0) {
          return '<span style="color: #a0aec0; font-style: italic;">No references available</span>';
        }
        
        return references.map(ref => {
          // Parse the reference (e.g., "1 Nephi 1:4" -> "1 Nephi 1:4")
          const encodedRef = encodeURIComponent(ref);
          const churchUrl = `https://www.churchofjesuschrist.org/study/scriptures/bofm/${encodedRef.toLowerCase().replace(/\s+/g, '-')}?lang=eng`;
          const ldsUrl = `https://www.lds.org/scriptures/bofm/${encodedRef.toLowerCase().replace(/\s+/g, '-')}?lang=eng`;
          
          return `<a href="${churchUrl}" target="_blank" rel="noopener noreferrer" 
                     style="color: #667eea; text-decoration: none; font-size: 13px; 
                            display: inline-block; margin: 2px 4px 2px 0; padding: 2px 6px; 
                            background: #f7fafc; border-radius: 4px; border: 1px solid #e2e8f0;
                            transition: all 0.2s ease;" 
                     onmouseover="this.style.background='#667eea'; this.style.color='white'; this.style.borderColor='#667eea';"
                     onmouseout="this.style.background='#f7fafc'; this.style.color='#667eea'; this.style.borderColor='#e2e8f0';">
                   ${ref}
                 </a>`;
        }).join('');
      }

      // Function to get connected nodes
      function getConnectedNodes(nodeId) {
        const connectedEdges = graphData.edges.filter(edge => 
          edge.from === nodeId || edge.to === nodeId
        );
        
        const connectedNodeIds = new Set();
        connectedEdges.forEach(edge => {
          if (edge.from === nodeId) connectedNodeIds.add(edge.to);
          if (edge.to === nodeId) connectedNodeIds.add(edge.from);
        });
        
        return Array.from(connectedNodeIds).map(id => {
          const node = graphData.nodes.find(n => n.id === id);
          const edge = connectedEdges.find(e => 
            (e.from === nodeId && e.to === id) || (e.to === nodeId && e.from === id)
          );
          return { node, relationship: edge ? edge.label : 'connected' };
        });
      }

      // Function to display detailed node information
      function displayNodeDetails(nodeData, isSelected = false) {
        const referencesHtml = createReferenceLinks(nodeData.references);
        const selectionClass = isSelected ? 'selected-node' : '';
        const connectedNodes = isSelected ? getConnectedNodes(nodeData.id) : [];
        
        let connectionsHtml = '';
        if (isSelected && connectedNodes.length > 0) {
          connectionsHtml = `
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
              <div style="font-weight: 500; color: #4a5568; margin-bottom: 8px;">Connected Entities:</div>
              <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                ${connectedNodes.map(({ node, relationship }) => `
                  <span style="display: inline-block; padding: 2px 6px; background: #edf2f7; 
                               border-radius: 4px; font-size: 12px; color: #4a5568; cursor: pointer;
                               transition: all 0.2s ease;" 
                        onmouseover="this.style.background='#667eea'; this.style.color='white';"
                        onmouseout="this.style.background='#edf2f7'; this.style.color='#4a5568';"
                        onclick="
                          const nodeData = graphData.nodes.find(n => n.id === '${node.id}');
                          if (nodeData) {
                            selectedNodeId = '${node.id}';
                            displayNodeDetails(nodeData, true);
                            highlightNode('${node.id}');
                          }
                        ">
                    ${node.label}
                    <span style="color: #a0aec0; font-size: 10px;">(${relationship})</span>
                  </span>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        detailsContent.innerHTML = `
          <div class="fade-in ${selectionClass}">
            <h4 style="margin: 0 0 12px 0; color: #2d3748; font-size: 18px; font-weight: 600; 
                       ${isSelected ? 'color: #667eea;' : ''}">
              ${nodeData.label}
              ${isSelected ? '<span style="font-size: 12px; color: #718096; margin-left: 8px;">(Selected)</span>' : ''}
            </h4>
            <div style="margin-bottom: 12px;">
              <span style="font-weight: 500; color: #4a5568;">Type:</span> 
              <span style="color: #667eea; font-weight: 500; text-transform: capitalize;">${nodeData.type}</span>
            </div>
            <div style="margin-bottom: 12px;">
              <span style="font-weight: 500; color: #4a5568;">ID:</span> 
              <span style="color: #718096; font-family: monospace; font-size: 12px;">${nodeData.id}</span>
            </div>
            <div>
              <div style="font-weight: 500; color: #4a5568; margin-bottom: 8px;">Scriptural References:</div>
              <div style="line-height: 1.6;">
                ${referencesHtml}
              </div>
            </div>
            ${nodeData.date ? `
              <div style="margin-top: 12px;">
                <span style="font-weight: 500; color: #4a5568;">Date:</span> 
                <span style="color: #667eea; font-weight: 500;">${nodeData.date}</span>
              </div>
            ` : ''}
            ${connectionsHtml}
          </div>`;
      }

      network.on('hoverNode', function (params) {
        var nodeId = params.node;
        var nodeData = graphData.nodes.find(node => node.id === nodeId);
        if (nodeData) {
          displayNodeDetails(nodeData);
        }
      });

      network.on('hoverEdge', function (params) {
        var edgeId = params.edge;
        var edgeData = graphData.edges.find(edge => edge.id === edgeId);
        if (edgeData) {
          const fromNode = graphData.nodes.find(n => n.id === edgeData.from);
          const toNode = graphData.nodes.find(n => n.id === edgeData.to);
          const referencesHtml = edgeData.references ? createReferenceLinks(edgeData.references) : '<span style="color: #a0aec0; font-style: italic;">No references available</span>';
          
          detailsContent.innerHTML = `
            <div class="fade-in">
              <h4 style="margin: 0 0 12px 0; color: #2d3748; font-size: 16px; font-weight: 600;">Relationship</h4>
              <div style="margin-bottom: 8px;">
                <span style="font-weight: 500; color: #4a5568;">From:</span> 
                <span style="color: #667eea; font-weight: 500;">${fromNode ? fromNode.label : edgeData.from}</span>
              </div>
              <div style="margin-bottom: 8px;">
                <span style="font-weight: 500; color: #4a5568;">To:</span> 
                <span style="color: #667eea; font-weight: 500;">${toNode ? toNode.label : edgeData.to}</span>
              </div>
              <div style="margin-bottom: 12px;">
                <span style="font-weight: 500; color: #4a5568;">Relationship:</span> 
                <span style="color: #718096; text-transform: capitalize;">${edgeData.label || 'Connected'}</span>
              </div>
              <div>
                <div style="font-weight: 500; color: #4a5568; margin-bottom: 8px;">Scriptural References:</div>
                <div style="line-height: 1.6;">
                  ${referencesHtml}
                </div>
              </div>
            </div>`;
        }
      });

      // Track selected node
      var selectedNodeId = null;

      // Handle node clicks
      network.on('click', function (params) {
        if (params.nodes.length > 0) {
          var nodeId = params.nodes[0];
          var nodeData = graphData.nodes.find(node => node.id === nodeId);
          
          if (nodeData) {
            selectedNodeId = nodeId;
            displayNodeDetails(nodeData, true);
            highlightNode(nodeId);
            
            // Add a small animation to show selection
            detailsContent.style.transform = 'scale(1.02)';
            setTimeout(() => {
              detailsContent.style.transform = 'scale(1)';
            }, 200);
          }
        } else {
          // Clicked on empty space - deselect
          selectedNodeId = null;
          detailsContent.innerHTML = '<div style="text-align: center; color: #a0aec0; font-style: italic;">Click on a node to see detailed information, or hover over nodes and edges to preview details.</div>';
          
          // Reset node highlighting
          graphData.nodes = graphData.nodes.map(node => ({
            ...node,
            borderWidth: 3,
            shadow: {
              enabled: true,
              color: 'rgba(0, 0, 0, 0.2)',
              size: 8,
              x: 2,
              y: 2
            }
          }));
          
          network.setData({
            nodes: new vis.DataSet(graphData.nodes),
            edges: new vis.DataSet(graphData.edges)
          });
        }
      });

      network.on('blurNode', function () {
        if (!selectedNodeId) {
          detailsContent.innerHTML = '<div style="text-align: center; color: #a0aec0; font-style: italic;">Click on a node to see detailed information, or hover over nodes and edges to preview details.</div>';
        }
      });

      network.on('blurEdge', function () {
        if (!selectedNodeId) {
          detailsContent.innerHTML = '<div style="text-align: center; color: #a0aec0; font-style: italic;">Click on a node to see detailed information, or hover over nodes and edges to preview details.</div>';
        }
      });

      // Legend and title are now in the HTML structure

      var searchInput = document.getElementById("searchInput");
      var searchResults = document.getElementById("searchResults");
      var edgeFilter = document.getElementById("edgeFilter");

      // Edge filtering functionality
      function filterEdges(relationshipType) {
        var filteredEdges;
        if (relationshipType === 'all') {
          filteredEdges = graphData.edges;
        } else {
          filteredEdges = graphData.edges.filter(edge => edge.label === relationshipType);
        }
        
        network.setData({
          nodes: new vis.DataSet(graphData.nodes),
          edges: new vis.DataSet(filteredEdges)
        });
      }

      // Add event listener for edge filtering
      edgeFilter.addEventListener('change', function() {
        filterEdges(this.value);
      });

      // Add a function to highlight a node
      function highlightNode(nodeId) {
        // Reset all nodes to default style
        graphData.nodes = graphData.nodes.map(node => ({
          ...node,
          borderWidth: 2,
          shadow: false
        }));

        // Highlight the selected node
        var selectedNode = graphData.nodes.find(node => node.id === nodeId);
        if (selectedNode) {
          selectedNode.borderWidth = 6;
          selectedNode.shadow = {
            enabled: true,
            color: 'rgba(0, 255, 0, 0.8)',
            size: 15,
            x: 0,
            y: 0
          };
        }

        // Update the network
        network.setData({
          nodes: new vis.DataSet(graphData.nodes),
          edges: new vis.DataSet(graphData.edges)
        });
      }

      searchInput.addEventListener("input", function () {
        var query = searchInput.value.toLowerCase();
        searchResults.innerHTML = "";

        if (query) {
          var results = graphData.nodes.filter(node =>
            node.label.toLowerCase().includes(query)
          );

          results.forEach(node => {
            var resultDiv = document.createElement("div");
            resultDiv.textContent = node.label;
            resultDiv.addEventListener("click", function () {
              // Select the node from search
              selectedNodeId = node.id;
              displayNodeDetails(node, true);
              highlightNode(node.id);
              
              // Clear search results
              searchInput.value = '';
              searchResults.innerHTML = '';
              
              // Add selection animation
              detailsContent.style.transform = 'scale(1.02)';
              setTimeout(() => {
                detailsContent.style.transform = 'scale(1)';
              }, 200);
            });
            searchResults.appendChild(resultDiv);
          });
        }
      });
    })
    .catch(error => {
      console.error('Error initializing graph:', error);
      document.getElementById('mynetwork').innerHTML = '<p>Error loading graph: ' + error.message + '</p>';
    });
</script>
</body>
</html>